<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>silo&éª¨æåº« å®¹é‡è¨­è¨ˆ </title>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 20px; font-size: 0.9em; }

        /* åˆ†é æŒ‰éˆ• */
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab-btn {
            flex: 1; padding: 15px; border: none; background: #f1f1f1; 
            font-size: 1.1em; font-weight: bold; cursor: pointer; color: #888; 
            transition: 0.2s;
        }
        .tab-btn:hover { background: #e9e9e9; }
        .tab-btn.active { background: #fff; color: #2c3e50; border-bottom: 4px solid #3498db; }

        /* å…§å®¹å€å¡Š */
        .tab-content { display: none; } /* é è¨­éš±è— */
        .tab-content.active { display: block; } /* å•Ÿç”¨æ™‚é¡¯ç¤º */

        .main-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; }
        @media (max-width: 800px) { .main-grid { grid-template-columns: 1fr; } }

        /* è¼¸å…¥å€ */
        .input-panel { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef; }
        .group-head { font-weight: bold; margin-top: 15px; margin-bottom: 8px; padding-bottom: 4px; border-bottom: 2px solid #ddd; color: #444; }
        
        .input-row { margin-bottom: 10px; }
        label { display: block; font-size: 0.9em; color: #555; font-weight: bold; margin-bottom: 4px; }
        input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-family: monospace; font-size: 15px; }
        input:focus { border-color: #3498db; outline: none; }
        
        .dual { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* çµæœå€ */
        .result-panel { text-align: center; }
        .info-card { background: #fff; border: 2px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 15px; text-align: left; }
        .res-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.95em; border-bottom: 1px dashed #eee; padding-bottom: 4px; }
        .res-val { font-weight: bold; font-family: monospace; color: #000; }

        .total-box { padding: 15px; border-radius: 8px; color: white; margin-top: 10px; text-align: center; }
        .bg-cement { background: #2980b9; }
        .bg-agg { background: #34495e; }
        .total-val { font-size: 1.5em; font-weight: bold; color: #f1c40f; }

        svg { width: 100%; height: 400px; background: white; border: 1px solid #ccc; border-radius: 8px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ—ï¸ æ··å‡åœŸå» å…¨èƒ½å®¹å™¨è¨­è¨ˆ (æœ€çµ‚ä¿®å¾©ç‰ˆ)</h2>
    <div class="subtitle">æ°´æ³¥æ¡¶ (åœ“å½¢) | éª¨æåº« (ç”°å­—å‹)</div>

    <div class="tabs">
        <button id="btn-cement" class="tab-btn active" onclick="switchTab('cement')">ğŸŸ¢ æ°´æ³¥æ¡¶ (Silo)</button>
        <button id="btn-agg" class="tab-btn" onclick="switchTab('agg')">ğŸŸ¤ éª¨æåº« (Bin)</button>
    </div>

    <div id="tab-cement" class="tab-content active">
        <div class="main-grid">
            <div class="input-panel">
                <div class="group-head" style="margin-top:0;">ğŸ“‹ éœ€æ±‚è¨­å®š</div>
                <div class="input-row"><label>éœ€æ±‚é‡é‡ (T)</label><input type="number" id="c_weight" value="150" oninput="runCement()"></div>
                <div class="input-row"><label>æ¯”é‡ (t/mÂ³)</label><input type="number" id="c_rho" value="1.33" oninput="runCement()"></div>
                <div class="input-row"><label>é ç•™é«˜ (m)</label><input type="number" id="c_fb" value="0.5" oninput="runCement()"></div>

                <div class="group-head">âš™ï¸ å°ºå¯¸åƒæ•¸</div>
                <div class="input-row"><label>ç›´å¾‘ (m)</label><input type="number" id="c_dia" value="4.37" oninput="runCement()"></div>
                <div class="input-row"><label>å–®å±¤æ¿é«˜ (m)</label><input type="number" id="c_plate_h" value="1.5" oninput="runCement()"></div>
                <div class="dual">
                    <div><label>éŒæ–—æ–œåº¦ (Â°)</label><input type="number" id="c_angle" value="60" oninput="runCement()"></div>
                    <div><label>å‡ºå£ (inch)</label><input type="number" id="c_out_inch" value="12" oninput="runCement()"></div>
                </div>
            </div>

            <div class="result-panel">
                <div class="info-card">
                    <div class="res-row"><span>æ‰€éœ€å±¤æ•¸ï¼š</span><span class="res-val" id="res_c_layers">--</span></div>
                    <div class="res-row"><span>ç›´èº«é«˜åº¦ï¼š</span><span class="res-val" id="res_c_cyl">--</span></div>
                    <div class="res-row"><span>éŒæ–—é«˜åº¦ï¼š</span><span class="res-val" id="res_c_cone">--</span></div>
                    <div class="res-row" style="background:#eef;"><span>ç¸½è¨­è¨ˆé«˜åº¦ï¼š</span><span class="res-val" id="res_c_total" style="color:#007bff">--</span></div>
                </div>
                <div class="total-box bg-cement">
                    <div style="font-size:0.9em; opacity:0.8;">é ä¼°æ»¿è¼‰é‡é‡</div>
                    <div class="total-val"><span id="res_c_max">0</span> T</div>
                </div>
                <svg id="svgCement" viewBox="0 0 400 500"></svg>
            </div>
        </div>
    </div>

    <div id="tab-agg" class="tab-content">
        <div class="main-grid">
            <div class="input-panel">
                <div class="group-head" style="margin-top:0;">1. å…±ç”¨çµæ§‹ (ç”°å­—å‹)</div>
                <div class="dual">
                    <div><label>ç¸½é•· L (m)</label><input type="number" id="a_L_tot" value="6.0" oninput="runAgg()"></div>
                    <div><label>ç¸½å¯¬ W (m)</label><input type="number" id="a_W_tot" value="6.0" oninput="runAgg()"></div>
                </div>
                <div class="dual" style="margin-top:10px;">
                    <div><label>ç›´èº«é«˜åº¦ (m)</label><input type="number" id="a_H_box" value="2.0" oninput="runAgg()"></div>
                    <div><label>é ç•™é«˜ (m)</label><input type="number" id="a_fb" value="0.3" oninput="runAgg()"></div>
                </div>

                <div class="group-head" style="color:#d35400; border-color:#d35400;">2. ç ‚å€‰ (å·¦å´)</div>
                <div class="dual">
                    <div><label>éŒæ–—å‚é«˜ (m)</label><input type="number" id="a_h_sand" value="2.5" oninput="runAgg()"></div>
                    <div><label>æ¯”é‡</label><input type="number" id="a_rho_sand" value="1.6" oninput="runAgg()"></div>
                </div>
                <label style="margin-top:5px;">å‡ºå£ (mm)</label>
                <div class="dual">
                    <input type="number" id="a_out_Ls" value="800" placeholder="L" oninput="runAgg()">
                    <input type="number" id="a_out_Ws" value="600" placeholder="W" oninput="runAgg()">
                </div>

                <div class="group-head" style="color:#555; border-color:#555;">3. çŸ³å€‰ (å³å´)</div>
                <div class="dual">
                    <div><label>éŒæ–—å‚é«˜ (m)</label><input type="number" id="a_h_stone" value="1.8" oninput="runAgg()"></div>
                    <div><label>æ¯”é‡</label><input type="number" id="a_rho_stone" value="1.55" oninput="runAgg()"></div>
                </div>
                <label style="margin-top:5px;">å‡ºå£ (mm)</label>
                <div class="dual">
                    <input type="number" id="a_out_Lst" value="800" placeholder="L" oninput="runAgg()">
                    <input type="number" id="a_out_Wst" value="600" placeholder="W" oninput="runAgg()">
                </div>
            </div>

            <div class="result-panel">
                <div class="info-card">
                    <div class="res-row"><span>å–®å€‰ä¸Šå£å°ºå¯¸ï¼š</span><span class="res-val" id="res_a_top">--</span></div>
                    <div class="res-row" style="color:#d35400"><span>ç ‚å€‰å–®é¡†å®¹ç©ï¼š</span><span class="res-val" id="res_a_vol_s">--</span></div>
                    <div class="res-row" style="color:#555"><span>çŸ³å€‰å–®é¡†å®¹ç©ï¼š</span><span class="res-val" id="res_a_vol_st">--</span></div>
                </div>
                <div class="total-box bg-agg">
                    <div style="font-size:0.9em; opacity:0.8;">ç¸½é‡é‡ (2ç ‚+2çŸ³)</div>
                    <div class="total-val"><span id="res_a_weight">0</span> T</div>
                    <div style="font-size:0.8em; margin-top:5px;">ç¸½å®¹ç©: <span id="res_a_vol">0</span> mÂ³</div>
                </div>
                <svg id="svgAgg" viewBox="0 0 500 500"></svg>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. åˆ†é åˆ‡æ›åŠŸèƒ½ ---
    function switchTab(tabName) {
        // éš±è—æ‰€æœ‰å…§å®¹
        document.getElementById('tab-cement').className = 'tab-content';
        document.getElementById('tab-agg').className = 'tab-content';
        
        // é‡ç½®æŒ‰éˆ•æ¨£å¼
        document.getElementById('btn-cement').className = 'tab-btn';
        document.getElementById('btn-agg').className = 'tab-btn';

        // é¡¯ç¤ºé¸ä¸­é …ç›®
        if (tabName === 'cement') {
            document.getElementById('tab-cement').className = 'tab-content active';
            document.getElementById('btn-cement').className = 'tab-btn active';
            runCement(); // å¼·åˆ¶é‡ç®—
        } else {
            document.getElementById('tab-agg').className = 'tab-content active';
            document.getElementById('btn-agg').className = 'tab-btn active';
            runAgg(); // å¼·åˆ¶é‡ç®—
        }
    }

    // --- 2. ç²å–æ•¸å€¼å·¥å…· ---
    function val(id) {
        let el = document.getElementById(id);
        if(!el) return 0;
        let v = parseFloat(el.value);
        return isNaN(v) ? 0 : v;
    }

    // --- 3. æ°´æ³¥æ¡¶è¨ˆç®— ---
    function runCement() {
        let W = val('c_weight');
        let rho = val('c_rho') || 1;
        let D = val('c_dia');
        let plateH = val('c_plate_h');
        let ang = val('c_angle');
        let out_inch = val('c_out_inch');
        let fb = val('c_fb');

        let d_out = out_inch * 0.0254;
        let R = D/2;
        let r = d_out/2;

        // è¨ˆç®—
        let h_cone = (R - r) * Math.tan(ang * Math.PI/180);
        if(h_cone < 0) h_cone = 0;
        let V_cone = (Math.PI * h_cone / 3) * (R*R + R*r + r*r);
        
        let V_req = W / rho;
        let V_cyl_needed = V_req - V_cone;
        let Area = Math.PI * R*R;
        let h_cyl_theo = V_cyl_needed > 0 ? V_cyl_needed / Area : 0;
        
        let layers = Math.ceil((h_cyl_theo + fb) / plateH);
        if(layers === 0 && h_cyl_theo > 0) layers = 1;
        let h_cyl_act = layers * plateH;
        
        let V_total = (Area * h_cyl_act) + V_cone;
        let W_total = V_total * rho;
        let H_total = h_cyl_act + h_cone;

        // æ›´æ–°æ–‡å­—
        document.getElementById('res_c_layers').innerText = layers;
        document.getElementById('res_c_cyl').innerText = h_cyl_act.toFixed(2) + " m";
        document.getElementById('res_c_cone').innerText = h_cone.toFixed(2) + " m";
        document.getElementById('res_c_total').innerText = H_total.toFixed(2) + " m";
        document.getElementById('res_c_max').innerText = W_total.toFixed(1);

        drawCement(D, h_cyl_act, h_cone, d_out, layers);
    }

    function drawCement(D, h1, h2, d_out, layers) {
        let svg = document.getElementById('svgCement');
        // é‡ç½® SVG (å«ç®­é ­å®šç¾©)
        svg.innerHTML = `<defs><marker id="ar" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#333"/></marker></defs>`;
        
        let w = 400, h = 400, pad = 50;
        let totalH = h1 + h2;
        if(totalH === 0) totalH = 1;
        
        let ppm = (h - pad*2) / totalH;
        if(D * ppm > (w - pad*2)) ppm = (w - pad*2) / D;

        let W_px = D * ppm;
        let H1_px = h1 * ppm;
        let H2_px = h2 * ppm;
        let out_px = Math.max(d_out * ppm, 5);
        let cx = w/2;
        let x = cx - W_px/2;
        let y = pad;

        // ç•«ç›´èº«
        addRect(svg, x, y, W_px, H1_px, "#dbeafe", "#2980b9");
        
        // ç•«å±¤ç·š
        if(layers > 0 && H1_px > 0) {
            let step = H1_px / layers;
            for(let i=1; i<layers; i++) {
                addLine(svg, x, y + i*step, x + W_px, y + i*step, "#2980b9", "4,2");
            }
        }

        // ç•«éŒæ–—
        let y2 = y + H1_px;
        let pts = `${x},${y2} ${x+W_px},${y2} ${cx+out_px/2},${y2+H2_px} ${cx-out_px/2},${y2+H2_px}`;
        addPoly(svg, pts, "#bfdbfe", "#2980b9");

        // æ¨™è¨»
        addText(svg, cx, y-15, `D=${D}m`, "#333");
        addText(svg, x+W_px+5, y+H1_px/2, `H=${h1.toFixed(2)}`, "#2980b9", "start");
        addText(svg, x+W_px+5, y2+H2_px/2, `h=${h2.toFixed(2)}`, "#2980b9", "start");
    }

    // --- 4. éª¨æåº«è¨ˆç®— ---
    function runAgg() {
        let L = val('a_L_tot');
        let W = val('a_W_tot');
        let H_box = val('a_H_box');
        let fb = val('a_fb');

        // Sand
        let h_s = val('a_h_sand');
        let rho_s = val('a_rho_sand');
        let out_Ls = val('a_out_Ls')/1000;
        let out_Ws = val('a_out_Ws')/1000;

        // Stone
        let h_st = val('a_h_stone');
        let rho_st = val('a_rho_stone');
        let out_Lst = val('a_out_Lst')/1000;
        let out_Wst = val('a_out_Wst')/1000;

        // é‚è¼¯
        let L_cell = L/2, W_cell = W/2;
        let A_top = L_cell * W_cell;
        let H_eff = Math.max(0, H_box - fb);
        let V_box = A_top * H_eff;

        // ç ‚
        let A_bot_s = out_Ls * out_Ws;
        let V_cone_s = (h_s/3)*(A_top + A_bot_s + Math.sqrt(A_top*A_bot_s));
        let V_s_one = V_box + V_cone_s;

        // çŸ³
        let A_bot_st = out_Lst * out_Wst;
        let V_cone_st = (h_st/3)*(A_top + A_bot_st + Math.sqrt(A_top*A_bot_st));
        let V_st_one = V_box + V_cone_st;

        let V_tot = (V_s_one * 2) + (V_st_one * 2);
        let W_tot = (V_s_one * rho_s * 2) + (V_st_one * rho_st * 2);

        // æ›´æ–°
        document.getElementById('res_a_top').innerText = `${L_cell.toFixed(2)} x ${W_cell.toFixed(2)} m`;
        document.getElementById('res_a_vol_s').innerText = V_s_one.toFixed(2) + " mÂ³";
        document.getElementById('res_a_vol_st').innerText = V_st_one.toFixed(2) + " mÂ³";
        document.getElementById('res_a_weight').innerText = W_tot.toFixed(1);
        document.getElementById('res_a_vol').innerText = V_tot.toFixed(1);

        drawAgg(L, H_box, h_s, h_st, out_Ls, out_Lst);
    }

    function drawAgg(L, H_box, h_s, h_st, w_s, w_st) {
        let svg = document.getElementById('svgAgg');
        svg.innerHTML = `<defs><marker id="ar" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#333"/></marker></defs>`;

        let w = 500, h = 400, pad = 50;
        let maxH = H_box + Math.max(h_s, h_st) + 1;
        if(maxH < 1) maxH = 1;
        
        let ppm = (h - pad*2) / maxH;
        if(L * ppm > (w - pad*2)) ppm = (w - pad*2) / L;

        let W_px = (L/2) * ppm;
        let H_box_px = H_box * ppm;
        let H_s_px = h_s * ppm;
        let H_st_px = h_st * ppm;
        let ws_px = Math.max(w_s*ppm, 5);
        let wst_px = Math.max(w_st*ppm, 5);

        let x = (w - W_px*2)/2;
        let y = pad;

        // ä¸Šæ–¹æ–¹ç®±
        addRect(svg, x, y, W_px, H_box_px, "#fff3e0", "#333"); // ç ‚
        addRect(svg, x+W_px, y, W_px, H_box_px, "#f5f5f5", "#333"); // çŸ³
        addLine(svg, x+W_px, y, x+W_px, y+H_box_px, "#999", "4,4");

        // ä¸‹æ–¹éŒæ–—
        let y2 = y + H_box_px;
        // å·¦ç ‚
        let cx_s = x + W_px/2;
        let pts_s = `${x},${y2} ${x+W_px},${y2} ${cx_s+ws_px/2},${y2+H_s_px} ${cx_s-ws_px/2},${y2+H_s_px}`;
        addPoly(svg, pts_s, "none", "#d35400");
        
        // å³çŸ³
        let cx_st = x + W_px + W_px/2;
        let pts_st = `${x+W_px},${y2} ${x+W_px*2},${y2} ${cx_st+wst_px/2},${y2+H_st_px} ${cx_st-wst_px/2},${y2+H_st_px}`;
        addPoly(svg, pts_st, "none", "#7f8c8d");

        // æ¨™è¨»
        addText(svg, cx_s, y+H_box_px/2, "ç ‚", "#d35400");
        addText(svg, cx_st, y+H_box_px/2, "çŸ³", "#555");
        addText(svg, cx_s, y2+H_s_px+20, `h=${h_s}`, "#d35400");
        addText(svg, cx_st, y2+H_st_px+20, `h=${h_st}`, "#555");
        
        // ç®­é ­
        let diff = Math.abs(h_s - h_st);
        let mx = x + W_px*2 + 20;
        let my1 = y2 + H_st_px;
        let my2 = y2 + H_s_px;
        addLine(svg, mx, my1, mx, my2, "#c0392b", null, true);
        addText(svg, mx+15, (my1+my2)/2, `Î” ${diff.toFixed(2)}`, "#c0392b", "start");
    }

    // --- SVG Helpers ---
    function addRect(svg, x, y, w, h, fill, stroke) {
        let el = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        el.setAttribute("x", x); el.setAttribute("y", y);
        el.setAttribute("width", w); el.setAttribute("height", h);
        el.setAttribute("fill", fill); el.setAttribute("stroke", stroke);
        el.setAttribute("stroke-width", 2);
        svg.appendChild(el);
    }
    function addLine(svg, x1, y1, x2, y2, color, dash, marker) {
        let el = document.createElementNS("http://www.w3.org/2000/svg", "line");
        el.setAttribute("x1", x1); el.setAttribute("y1", y1);
        el.setAttribute("x2", x2); el.setAttribute("y2", y2);
        el.setAttribute("stroke", color); el.setAttribute("stroke-width", 2);
        if(dash) el.setAttribute("stroke-dasharray", dash);
        if(marker) {
            el.setAttribute("marker-start", "url(#ar)");
            el.setAttribute("marker-end", "url(#ar)");
        }
        svg.appendChild(el);
    }
    function addPoly(svg, pts, fill, stroke) {
        let el = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
        el.setAttribute("points", pts); el.setAttribute("fill", fill);
        el.setAttribute("stroke", stroke); el.setAttribute("stroke-width", 2);
        svg.appendChild(el);
    }
    function addText(svg, x, y, txt, color, anchor="middle") {
        let el = document.createElementNS("http://www.w3.org/2000/svg", "text");
        el.setAttribute("x", x); el.setAttribute("y", y);
        el.setAttribute("fill", color); el.setAttribute("text-anchor", anchor);
        el.setAttribute("font-family", "monospace"); el.setAttribute("font-weight", "bold");
        el.textContent = txt;
        svg.appendChild(el);
    }

    // åˆå§‹åŒ–
    runCement();
</script>

</body>
</html>
